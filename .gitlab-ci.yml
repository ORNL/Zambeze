
stages:
  - test

test-zambeze:
  stage: test
  tags:
    - cades
  script:
    - python3.9 -m venv /opt/zambeze/zambeze-py39-env
    - source /opt/zambeze/zambeze-py39-env/bin/activate
    - python3.9 -m pip uninstall -y zambeze
    - python3.9 -m pip install -r requirements.txt
    - python3.9 -m pip install .
    - chmod 600 $ZAMBEZE_CI_TEST_RSYNC_SSH_KEY
    - python3.9 -m pytest -m unit -sv
    - python3.9 -m pytest -m gitlab_runner -sv

# Ideally this job would use a virtual environment that was provisioned by 
# Ansible, as it is, if the VM goes down this venv disappears
test-zambeze-globus:
  stage: test
  tags:
    - globus
  script:
    - python3.9 -m venv /opt/zambeze/zambeze-py39-env
    - source /opt/zambeze/zambeze-py39-env/bin/activate
    - python3.9 -m pip uninstall -y zambeze
    - python3.9 -m pip install -r requirements.txt
    - python3.9 -m pip install .
    - python3.9 -m pytest -m unit -sv
    - python3.9 -m pytest -m globus -sv
